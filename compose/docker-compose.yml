version: '2'

services:
  spark-master:
    extends:
      file: common-services.yml
      service: spark-master

  spark-slave1:
    extends:
      file: common-services.yml
      service: spark-slave
    container_name: slave1
    hostname: slave1
    environment:
       - "constraint:node==swarm-node-1"
    ports:
      - 8082:8081

  spark-slave2:
    extends:
      file: common-services.yml
      service: spark-slave
    container_name: slave2
    hostname: slave2
    environment:
      - "constraint:node==swarm-node-2"
    ports:
      - 8083:8081

  nats-main: 
    extends:
      file: common-services.yml
      service: nats
      
  gatling:
    extends:
      file: common-services.yml
      service: gatling
    links: 
      - nats-main
    environment:
      - NATS_URI=nats://nats-main:4222
      
  app:
    extends:
      file: common-services.yml
      service: app
    links: 
      - nats-main
      - spark-master
    environment:
      - NATS_URI=nats://nats-main:4222
      - SPARK_MASTER_URL=spark://master:7077
      
  monitor:
    extends:
      file: common-services.yml
      service: monitor
    links: 
      - nats-main
