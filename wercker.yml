box: hseeberger/scala-sbt
build:
  steps:
    - script:
        name: build dockerfile(s)
        code: |
          pushd shell
          sbt clean assembly dockerFileTask
          popd
          ls -als ./*/target/docker/
    - install-packages:
        name: install git
        packages: git
    - add-to-known_hosts:
        name: add-to-known_hosts
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - add-ssh-key:
        name: add-ssh-key
        keyname: GITHUB_SSH_KEY
    - script:
        name: git push
        code: |
          git fetch origin
          git merge origin master_docker
          git push origin master_docker


buildX:
  steps:
    - script:
        name: build docker
        code: |
          pushd app
          sbt clean docker
          popd
          pushd inject
          sbt clean docker
          popd
          pushd monitor
          sbt clean docker
          popd
          pushd shell
          sbt clean docker
          popd
          ls ./*/target/docker/
